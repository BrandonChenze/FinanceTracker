{% extends "base.html" %}

{% block header %}
<title>Finance Tracker - Home</title>
{% endblock %}

{% block content %}

<div>
<h1>CSV Upload</h1>
    <form action="/upload" method="post" enctype="multipart/form-data">
        Upload file
        <select name="bank">
            <option>Wells Fargo</option>
            <option>Marcus</option>
        </select>
        <input type="file" name="csv_file" accept=".csv">
        <button type="submit">Upload</button>
    </form>
</div>

    <div id="add_item">
        <form id="container" method="post">
            <label>Description:</label>
            <input type="text" name="description" placeholder="Description" class="center_text" required>
            
            <label>Category:</label>
            <select name="category" class="center_text" required> 
                <option value="Food">Food</option>
                <option value="Amazon">Amazon</option>
                <option value="Gas">Gas</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Health">Health</option>
            </select>
            
            <label>Price:</label>
            <input type="number" name="price" step="0.01" min="0" placeholder="$10.99" class="center_text" required>
            
            <label>Date:</label>
            <input id="date_input" type="date" name="date" placeholder="Description" class="center_text" required>
            
            <button type="submit">+</button>
        </form>
    </div>    
    
    <div style="display: flex; justify-content: center; ">
        <canvas id="myChart" style="height: 50vh; width: 80%;"></canvas>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('myChart');
        var chart_values = {{chart_values | tojson}};
        var chart_data = {{chart_data | tojson}}
        new Chart(ctx, {
            type: 'bar',
            data: {
            labels: chart_data,
            datasets: [{
                label: '$ Spent',
                data: chart_values,
                borderWidth: 1
            }]
            },
            options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                beginAtZero: true
                }
            }
            }
        });
    </script>

    <div id="overview">
        <fieldset id="budgeting">
            <legend>Budgeting</legend>
            <span class="budgeting_item">Total Spent: ${{"%.2f"|format(total)}}  </span>
            <span class="budgeting_item">Monthly Income: ${{"%.2f"|format(4400 - total)}} / $4400</span>
            <span class="budgeting_item">Monthly Budget: {{"%.2f"|format(total| int / 10)}}% of $1000</span>
        </fieldset>
            
        <fieldset id="budgeting">
            <legend>Categories</legend>
            {% for category in categories %}
                <span class="budgeting_item">{{category[0]}}: ${{"%.2f"|format(category[1])}}</span>
            {% endfor %}
        </fieldset>
    </div>
    
    <div id="transaction_filter">
        <form method="post">
            Start: <input id="filter_start" name="start" type="date" class="filter">
            End: <input id="filter_end" name="end" type="date" class="filter">
            <button type="submit" class="filter">Filter</button>
            <a href="/"><button type="button" class="filter">Reset Filter</button></a>
        </form>
       
        <label class="filter">Sort By:
            <select>
                <option>Date</option>
                <option>Price</option>
            </select>
        </label>
    </div>

    {% for transaction in data %}
    <div id="transaction">
        <span id="details">
            {% if transaction.category == 'Income' %}
            Price: <span class="income">${{"%.2f"|format(transaction.price)}} </span>
            {% else %}
            Price: <span class="credit">${{"%.2f"|format(transaction.price)}}</span>
            {% endif %}
            <br>
            Description: {{transaction.description}} 
            <br>
            Category: {{transaction.category}}
            
        </span>
        <span id="date">
            {{transaction.date}}<br>
            <a href="delete/{{transaction.id}}"><button id="trash-btn">X</button></a><br>
            <button>Edit</button>
        </span>
    </div>
    {% endfor %}

    <div id="page_navigation">
        <a href="?page={{current_page - 1 if current_page > 1 else 1}}"><button><</button></a>
        <span>Page {{current_page}}</span>
        <a href="?page={{current_page + 1}}"><button>></button></a>
    </div>
    
{% endblock %}
